import sqlite3        # Knjižnica za delo z bazo
import csv            # Knjižnica za delo s CSV datotekami
import re             # Knjižnica za delo z regularnimi izrazi
import sys            # Knjižnica za komunikacijo s sistemom
import urllib.request # Knjižnica za delo s spletom

BAZA = "baza.sqlite3"

def getObcina(x):
    # TODO
    pass
    
# Pomožna funkcija za normalizacijo spola
def getSpol(s):
    if type(s) == str:
        if s[0] == 'm' or s[0] == 'M':
            return "Moški"
        elif s[0] == 'ž' or s[0] == 'z' or s[0] == 'Ž' or s[0] == 'Z':
            return "Ženske"
    return None

#uvoz iz Excela
def importData(): 
    pass

    # Obvezno moramo narediti commit, sicer se ne zgodi nič
    baza.commit()
    print("Končano.")

#uvoz s spletnih strani
def uvozCestnin():
    pass

# POIZVEDUJEMO ZA PODATKI
def query(obcina=None, spol=None, minst=None, maxst=None):
    c = baza.cursor()
    # TODO
    c.close()

# DODAJAMO PODATKE V BAZO
def add(obcina, leto, polletje, spol, starost, stevilo):
    # TODO
    pass

if __name__ == '__main__':
    ok = len(sys.argv) > 1
    if ok:
        if sys.argv[1] == "import":
            importData()
        elif sys.argv[1] == "query":
            obcina=None
            spol=None
            minst=None
            maxst=None
            for i in range(2, len(sys.argv)):
                ok = True
                m = re.match(r'^(obcina|spol|starost)([=<>])(.+)$', sys.argv[i])
                if m == None:
                    ok = False
                elif m.group(1) == "obcina" and m.group(2) == "=":
                    obcina = m.group(3)
                elif m.group(1) == "spol" and m.group(2) == "=":
                    spol = m.group(3)
                elif m.group(1) == "starost":
                    if m.group(2) == ">":
                        minst = m.group(3)
                    elif m.group(2) == "<":
                        maxst = m.group(3)
                    else:
                        minst = m.group(3)
                        maxst = m.group(3)
                else:
                    ok = False
                if not ok:
                    print("Ignoriram neznan parameter: %s" % sys.argv[i])
            ok = True
            query(obcina, spol, minst, maxst)
        elif sys.argv[1] == "add" and len(sys.argv) > 7:
            try:
                obcina = sys.argv[2]
                leto = int(sys.argv[3])
                polletje = int(sys.argv[4])
                spol = getSpol(sys.argv[5])
                starost = int(sys.argv[6])
                stevilo = int(sys.argv[7])
                if polletje < 1 or polletje > 2:
                    print("Napačno polletje!")
                elif spol == None:
                    print("Napačen spol!")
                elif starost < 0 or starost > 85:
                    print("Neveljavna starost!")
                elif stevilo < 0:
                    print("Napačno število!")
                else:
                    add(obcina, leto, polletje, spol, starost, stevilo)
            except:
                ok = False
        else:
            ok = False
    if not ok:
        print("Uporaba: %s { import | query [obcina=...] [spol={M|Ž}] [starost{<|=|>}...] ... | add občina leto {1|2} {M|Ž} starost število }" % sys.argv[0])
